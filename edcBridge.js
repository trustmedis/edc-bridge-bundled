!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.edcBridge=t():e.edcBridge=t()}(self,(()=>{return e={98:e=>{e.exports={"00":"APPROVE",54:"DECLINE EXPIRED CARD",55:"DECLINE EXPIRED PIN",P2:"READ CARD ERROR",P3:"USER PRESS CANCEL ON EDC",Z3:"EMV CARD DECLINE",CE:"CONNECTION ERROR / LINE BUSY TO CONNECTION TIMEOUT",PT:"EDC PROBLEM",S2:"FAILED TRANSACTION",S3:"TXN BLM DIPROSES MINTA SCAN QR",S4:"TXN EXPIRED"}},288:e=>{e.exports={ecrVersion:[0,1],transAmount:[3,15],otherAmount:[15,27],PAN:[27,46],expiryDate:[46,50],rrn:[52,64],approvalCode:[64,70],date:[70,78],time:[78,84],merchantId:[84,99],terminalId:[99,107],offlineFlag:[107,108],cardHolderName:[108,134],panCashierFlag:[134,150],invoiceNumber:[150,156],batchNumber:[156,162],issuerId:[162,164],installmentFlag:[164,165],dccFlag:[165,166],redeemFlag:[166,167],informationAmount:[167,179],dccDecimalPlace:[179,180],dccCurrencyName:[180,183],dccExchangeRate:[183,191],couponFlag:[191,192],filler:[192,200]}},706:e=>{e.exports={"01":"PURCHASE",17:"ECHO_TEST","08":"VOID"}},437:(e,t,r)=>{const{calculateLRC:o,setAmount:n,formatCardNumber:c}=r(555),s=r(288),a=r(706),i=r(98);e.exports={constructMessage:({msgLength:e="P",ecrVersion:t="",amount:r=1,cardNumber:s="                ",expireDate:a="    ",transType:i="01",cancelReason:d="00",invoiceNumber:l="000000",genericData:p="            ",authorizationIDResponse:E="000000"}={})=>{const u=`${e}${t}${i}${r=n(r.toString())}000000000000${s=c(s)}${a}${d}${l}${E}  N00000${p=p.padEnd(12," ")}                                                                   `;return`${u}${o(u)}`},parseResponse:async(e,t)=>{let r=[];const n=new TextEncoder;if(1===e.length){const t=parseInt(e[0]);switch(t){case 6:console.log("ACK received"),r._type="ACK";break;case 15:console.log("NAK received"),r._type="NAK";break;default:r._type="UND",r.code=t}return r}const c=new TextDecoder;r._type="MSG",r.lrc=e.slice(-1).toString(),o(e.slice(1,-1),!0)!==r.lrc&&await t.write(n.encode(""));const d=(e=e.slice(3,-2)).slice(1,3),l=c.decode(d).trim();if(!Object.keys(a).includes(l))return[];r.transType=a[l];const p=c.decode(e.slice(50,52)).trim();for(segmentProp in Object.keys(i).includes(p)?r.respCode=i[p]:r.respCode=`DECLINE ${p}`,s){const t=s[segmentProp];r[segmentProp]=c.decode(e.slice(t[0],t[1])).trim()}return await t.write(n.encode("")),console.log("ACK sent..."),r}}},555:e=>{e.exports={calculateLRC:(e,t=!1)=>{t&&(e=(new TextDecoder).decode(e));let r=0;for(s of e)r^=s.charCodeAt();return t?r.toString():String.fromCharCode(parseInt(r.toString(16),16))},setAmount:e=>(e=e.toString(),(e+="00").padStart(12,"0")),formatCardNumber:e=>e.padEnd(19," ")}}},t={},function r(o){var n=t[o];if(void 0!==n)return n.exports;var c=t[o]={exports:{}};return e[o](c,c.exports,r),c.exports}(437);var e,t}));